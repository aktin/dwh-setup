<?xml version="1.0" encoding="UTF-8"?>
<!--
$Id: data_build.xml,v 1.2 2010/04/05 13:52:11 lcp5 Exp $
-->
<project name="AKTIN DWH" basedir=".">
    <scriptdef language="javascript" name="capitalize">
        <attribute name="string" />
        <attribute name="to" />

        var s = new String( attributes.get( "string" ) );
        project.setProperty( attributes.get( "to" ),
                s.toLowerCase().replace( /^.|\s\S/g,
                function(a) { return a.toUpperCase(); }) );
    </scriptdef>
    <scriptdef language="javascript" name="upper">
        <attribute name="string" /> 
        <attribute name="to" />

        project.setProperty( attributes.get( "to" ),
                             attributes.get( "string" ).toUpperCase() );
    </scriptdef>

	<property environment="env" />
    <property name="project.name" value="aktin"/>
    <capitalize string="${project.name}" to="project.cname" />
    <upper string="${project.name}" to="project.uname" />
    <property name="project.installroot" value="/vagrant/temp_install"/>

    <!-- =================================================================== -->
    <!--     Change properties                                               -->
    <!-- =================================================================== -->
    
    <target name="change_properties">
        <replace file="build.properties" value="" failOnNoReplacements="false">
            <!-- move the install root -->
            <replacefilter token="ant.installdata.dir=/vagrant/i2b2_install/" value="ant.installdata.dir=${project.installroot}"/>
            <replacefilter token="i2b2.src.dir=/vagrant/temp_install/i2b2_src" value="i2b2.src.dir=${project.installroot}/i2b2_src"/>
            <!-- <replacefilter token="log.dir=/vagrant/logs" value="log.dir=/var/log"/> -->
            <!-- <replacefilter token="packages.dir=/vagrant/packages/" value="packages.dir=/vagrant/packages/"/> -->
        </replace>
        <replaceregexp file="build.properties" match="(db.project=)[a-zA-Z]+" replace="\1${project.name}" flags="g" byline="true"/>
        <replaceregexp file="build.properties" match="(db.project.name=)[a-zA-Z]+" replace="\1${project.cname}" flags="g" byline="true"/>
        <replaceregexp file="build.properties" match="(db.project.uname=i2b2_)[a-zA-Z]+" replace="\1${project.uname}" flags="g" byline="true"/>
        <replaceregexp file="build.properties" match="(db.hive.id=i2b2)[a-zA-Z]+" replace="\1${project.name}" flags="g" byline="true"/>
        
    </target>       
</project>
